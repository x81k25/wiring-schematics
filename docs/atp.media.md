# atp.media

## Description

Main pipeline data for movies/TV shows. V31: Standardized timestamp triggers.

## Columns

| Name | Type | Default | Nullable | Children | Parents | Comment |
| ---- | ---- | ------- | -------- | -------- | ------- | ------- |
| hash | character(40) |  | false |  |  | primary key; unique identifier; and primary element for interaction with transmission |
| media_type | atp.media_type |  | false |  |  | either movie, tv_shows, or tv_season |
| media_title | varchar(255) |  | true |  |  | either movie or tv show title |
| season | integer |  | true |  |  | media season if tv show or tv season; null for movies |
| episode | integer |  | true |  |  | episode number within season for tv show, otherwise null |
| release_year | integer |  | true |  |  | year the movie was released or the year of the first season of a tv show |
| pipeline_status | atp.pipeline_status | 'ingested'::atp.pipeline_status | false |  |  | status within the automatic transmission pipeline |
| error_status | boolean | false | false |  |  | boolean value documenting errors occurring during pipeline |
| error_condition | text |  | true |  |  | details on error status |
| rejection_status | atp.rejection_status | 'unfiltered'::atp.rejection_status | false |  |  | rejection status based on filters within filter-parameters.json |
| rejection_reason | text |  | true |  |  | details on which filter flags were tagged, if rejection was caused |
| parent_path | text |  | true |  |  | parent dir of media library location for item |
| target_path | text |  | true |  |  | file or dir path for media library location |
| original_title | text |  | false |  |  | raw item title string value; used for parsing other field values |
| original_path | text |  | true |  |  | original path of item within media-cache |
| original_link | text |  | true |  |  | may contain either the direct download link or the magnet link |
| rss_source | atp.rss_source |  | true |  |  | source of rss feed for item ingestion, if any |
| uploader | varchar(25) |  | true |  |  | uploading entity of the media item |
| imdb_id | varchar(10) |  | true |  |  | from TMDB; IMDB identifier for media item |
| tmdb_id | integer |  | true |  |  | from TMDB; identifier for themoviedb.org API |
| resolution | varchar(10) |  | true |  |  | video resolution |
| video_codec | varchar(10) |  | true |  |  | video compression codec |
| upload_type | varchar(10) |  | true |  |  | uploading type indicating source of upload |
| audio_codec | varchar(10) |  | true |  |  | audio codec |
| created_at | timestamp with time zone | (CURRENT_TIMESTAMP AT TIME ZONE 'UTC'::text) | false |  |  | timestamp for initial database creation of item |
| updated_at | timestamp with time zone | (CURRENT_TIMESTAMP AT TIME ZONE 'UTC'::text) | false |  |  | timestamp of last database alteration of item |
| deleted_at | timestamp with time zone |  | true |  |  | Soft delete timestamp. NULL = active, timestamp = deleted. |

## Constraints

| Name | Type | Definition |
| ---- | ---- | ---------- |
| media_hash_check | CHECK | CHECK (((hash ~ '^[a-f0-9]+$'::text) AND (length(hash) = 40))) |
| media_imdb_id_check | CHECK | CHECK (((imdb_id)::text ~ '^tt[0-9]{7,8}$'::text)) |
| media_release_year_check | CHECK | CHECK (((release_year >= 1850) AND (release_year <= 2100))) |
| media_tmdb_id_check | CHECK | CHECK ((tmdb_id > 0)) |
| media_pkey | PRIMARY KEY | PRIMARY KEY (hash) |

## Indexes

| Name | Definition |
| ---- | ---------- |
| media_pkey | CREATE UNIQUE INDEX media_pkey ON atp.media USING btree (hash) |
| idx_media_imdb_id | CREATE INDEX idx_media_imdb_id ON atp.media USING btree (imdb_id) |
| idx_media_tmdb_id | CREATE INDEX idx_media_tmdb_id ON atp.media USING btree (tmdb_id) |
| idx_media_pipeline_status | CREATE INDEX idx_media_pipeline_status ON atp.media USING btree (pipeline_status) |

## Triggers

| Name | Definition |
| ---- | ---------- |
| reset_fields_on_ingestion | CREATE TRIGGER reset_fields_on_ingestion BEFORE UPDATE ON atp.media FOR EACH ROW EXECUTE FUNCTION atp.reset_on_ingestion() |
| clear_error_condition | CREATE TRIGGER clear_error_condition BEFORE UPDATE ON atp.media FOR EACH ROW EXECUTE FUNCTION atp.reset_error_condition() |
| clear_rejection_reason | CREATE TRIGGER clear_rejection_reason BEFORE UPDATE ON atp.media FOR EACH ROW EXECUTE FUNCTION atp.reset_rejection_reason() |
| trg_media_soft_delete | CREATE TRIGGER trg_media_soft_delete BEFORE UPDATE ON atp.media FOR EACH ROW WHEN ((old.deleted_at IS DISTINCT FROM new.deleted_at)) EXECUTE FUNCTION atp.set_rejection_on_soft_delete() |
| update_media_updated_at | CREATE TRIGGER update_media_updated_at BEFORE UPDATE ON atp.media FOR EACH ROW EXECUTE FUNCTION atp.set_updated_at() |

## Relations

![er](atp.media.svg)

---

> Generated by [tbls](https://github.com/k1LoW/tbls)
